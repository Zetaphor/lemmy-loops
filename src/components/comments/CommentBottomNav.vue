<template>
  <CommentSortSelector v-if="showSortSelector" @setSort="sortUpdated" />

  <div class="btm-nav z-20" v-show="!overlay.hideNav">
    <!-- Sort selector -->
    <button v-if="site.commentSort == 'Old'" @click="toggleSortSelector">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-20 h-full stroke-gray-400 fill-gray-400" viewBox="30 20 35 60">
        <path
          d="M50 977.36c-13.78 0-25 11.22-25 25 0 13.79 11.22 25 25 25s25-11.21 25-25c0-13.78-11.22-25-25-25zm0 4c11.62 0 21 9.38 21 21s-9.38 21-21 21-21-9.38-21-21 9.38-21 21-21zm0 6a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2h11a2 2 0 1 0 0-4h-9v-11a2 2 0 0 0-2-2z"
          color="#000" overflow="visible" transform="translate(0 -952.36)" />
      </svg>
      <span class="btm-nav-label">Old</span>
    </button>
    <button v-else-if="site.commentSort == 'New'" @click="toggleSortSelector">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-20 h-full stroke-current fill-current" viewBox="550 200 800 1300">
        <path
          d="M733.652 1243.706a20 20 0 0 1-18.712-12.939c-34.836-92.316-99.33-161.958-147.299-204.124-52.132-45.825-95.956-69.628-96.392-69.863a20 20 0 0 1 0-35.218c.43-.232 44.984-24.522 97.202-70.577 47.678-42.051 111.796-111.475 146.489-203.411a20 20 0 0 1 37.424 0c34.836 92.316 99.33 161.958 147.299 204.125 52.132 45.825 95.956 69.628 96.392 69.863a20 20 0 0 1 0 35.218c-.43.232-44.984 24.522-97.202 70.577-47.678 42.05-111.796 111.475-146.489 203.411a20 20 0 0 1-18.712 12.938zM519.022 939.17c19.016 12.524 45.748 31.692 75.028 57.43 32.603 28.659 61.654 59.604 86.346 91.974 20.924 27.431 38.744 55.946 53.256 85.184 14.512-29.237 32.333-57.753 53.256-85.184 24.691-32.37 53.742-63.314 86.346-91.974 29.28-25.738 56.012-44.906 75.028-57.43-19.016-12.524-45.748-31.692-75.028-57.43-32.603-28.66-61.654-59.604-86.346-91.974-20.924-27.431-38.744-55.946-53.256-85.184-14.512 29.237-32.332 57.753-53.256 85.184-24.691 32.37-53.742 63.314-86.346 91.974-29.28 25.739-56.012 44.906-75.028 57.43zm581.994 516.997a20 20 0 0 1-18.712-12.939c-28.647-75.916-104.481-117.802-105.244-118.217a20.026 20.026 0 0 1-10.47-17.62c.013-7.345 4.035-14.1 10.502-17.582.731-.397 76.565-42.284 105.213-118.2a20 20 0 0 1 37.424 0c28.815 76.359 104.452 117.791 105.213 118.2a20 20 0 0 1 0 35.218c-.731.397-76.565 42.284-105.213 118.2a20.002 20.002 0 0 1-18.713 12.94zm-77.929-148.749c22.39 16.466 54.209 44.368 77.929 83.446 23.72-39.078 55.539-66.979 77.929-83.446-22.39-16.467-54.209-44.369-77.929-83.446-23.72 39.078-55.539 66.98-77.929 83.446zm306.3-296.328a20 20 0 0 1-18.712-12.939c-49.533-131.262-179.356-202.377-180.662-203.08a20 20 0 0 1 0-35.218c.311-.168 33.443-18.254 72.248-52.517 35.3-31.168 82.764-82.59 108.414-150.563a20 20 0 0 1 37.424 0c25.65 67.973 73.114 119.395 108.414 150.563 38.805 34.263 71.937 52.349 72.267 52.527a20.015 20.015 0 0 1 10.489 17.616 20 20 0 0 1-10.508 17.593c-.311.168-33.443 18.254-72.248 52.518-35.3 31.168-82.764 82.59-108.414 150.563a20 20 0 0 1-18.712 12.937zm-152.199-233.628c13.792 9.402 31.53 22.543 50.677 39.375 31.586 27.765 72.035 70.316 101.522 125.889 29.488-55.572 69.936-98.124 101.522-125.889 19.147-16.832 36.885-29.972 50.677-39.375-13.792-9.402-31.529-22.543-50.677-39.375-31.586-27.765-72.034-70.316-101.522-125.889-29.487 55.573-69.936 98.124-101.522 125.889-19.147 16.832-36.885 29.973-50.677 39.375z" />
      </svg>
      <span class="btm-nav-label">New</span>
    </button>
    <button v-else-if="site.commentSort == 'Top'" @click="toggleSortSelector">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-20 h-full stroke-current fill-current" viewBox="-10 935 110 115">
        <path
          d="M55.844 957.354c-6.228 2.791-11.51 12.895-12.782 18.658-.517 2.51-.587 4.975-.437 7.438-.83-1.72-1.448-3.695-1.625-6.313a3.068 3.068 0 0 0-1.844-2.575 3.068 3.068 0 0 0-3.125.512C24.861 984.814 18 999.472 18 1013.765c0 15.758 9.07 26.177 21.969 33.222 1.096.612 2.578.435 3.5-.418.922-.853 1.213-2.316.687-3.457-.662-1.453-1.156-2.84-1.156-4.344 0-4.968 3.123-10.234 7-12.814 3.879 2.578 7 7.841 7 12.814 0 1.49-.497 2.89-1.156 4.344-.526 1.14-.235 2.604.687 3.457.922.854 2.404 1.03 3.5.418C72.943 1039.945 82 1029.534 82 1013.765c0-13.65-6.752-22.669-12.719-30.315-5.967-7.646-10.95-13.772-10.281-22.877.126-1.695-1.459-3.312-3.156-3.219zm-2.282 10.407c1.674 7.613 6.494 13.603 11 19.377C70.475 994.714 76 1002.049 76 1013.765c0 11.133-4.895 18.352-13.125 24.19-.31-7.74-4.834-15.113-11.594-18.314a3.045 3.045 0 0 0-2.562 0c-6.754 3.203-11.283 10.575-11.594 18.314-8.226-5.842-13.125-13.07-13.125-24.19 0-10.63 4.583-21.94 12.125-30.346 1.762 5.277 5.302 8.96 9.281 11.47.99.621 2.35.588 3.31-.08.959-.668 1.461-1.933 1.221-3.077-1.213-5.75-1.889-10.188-1-14.501.603-2.922 2.014-5.978 4.626-9.47z" />
      </svg>
      <span class="btm-nav-label">Top</span>
    </button>
    <button v-else-if="site.commentSort == 'Hot'" @click="toggleSortSelector">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-20 h-full stroke-current fill-current" viewBox="-10 935 110 115">
        <path
          d="M55.844 957.354c-6.228 2.791-11.51 12.895-12.782 18.658-.517 2.51-.587 4.975-.437 7.438-.83-1.72-1.448-3.695-1.625-6.313a3.068 3.068 0 0 0-1.844-2.575 3.068 3.068 0 0 0-3.125.512C24.861 984.814 18 999.472 18 1013.765c0 15.758 9.07 26.177 21.969 33.222 1.096.612 2.578.435 3.5-.418.922-.853 1.213-2.316.687-3.457-.662-1.453-1.156-2.84-1.156-4.344 0-4.968 3.123-10.234 7-12.814 3.879 2.578 7 7.841 7 12.814 0 1.49-.497 2.89-1.156 4.344-.526 1.14-.235 2.604.687 3.457.922.854 2.404 1.03 3.5.418C72.943 1039.945 82 1029.534 82 1013.765c0-13.65-6.752-22.669-12.719-30.315-5.967-7.646-10.95-13.772-10.281-22.877.126-1.695-1.459-3.312-3.156-3.219zm-2.282 10.407c1.674 7.613 6.494 13.603 11 19.377C70.475 994.714 76 1002.049 76 1013.765c0 11.133-4.895 18.352-13.125 24.19-.31-7.74-4.834-15.113-11.594-18.314a3.045 3.045 0 0 0-2.562 0c-6.754 3.203-11.283 10.575-11.594 18.314-8.226-5.842-13.125-13.07-13.125-24.19 0-10.63 4.583-21.94 12.125-30.346 1.762 5.277 5.302 8.96 9.281 11.47.99.621 2.35.588 3.31-.08.959-.668 1.461-1.933 1.221-3.077-1.213-5.75-1.889-10.188-1-14.501.603-2.922 2.014-5.978 4.626-9.47z" />
      </svg>
      <span class="btm-nav-label">Hot</span>
    </button>

    <!-- Menu -->
    <button>
      <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current fill-current w-20 h-full" viewBox="0 -30 128 160">
        <path
          d="M22 67v-6c0-1.7-1.3-3-3-3s-3 1.3-3 3v6c0 1.7 1.3 3 3 3s3-1.3 3-3zm15.4 37.1 5.2 3c.5.3 1 .4 1.5.4 1 0 2-.5 2.6-1.5.8-1.4.3-3.3-1.1-4.1l-5.2-3c-1.4-.8-3.3-.3-4.1 1.1-.8 1.4-.3 3.3 1.1 4.1zm54.3-4.1c-.8-1.4-2.7-1.9-4.1-1.1l-5.2 3c-1.4.8-1.9 2.7-1.1 4.1.6 1 1.6 1.5 2.6 1.5.5 0 1-.1 1.5-.4l5.2-3c1.4-.8 1.9-2.7 1.1-4.1zM112 67v-6c0-1.7-1.3-3-3-3s-3 1.3-3 3v6c0 1.7 1.3 3 3 3s3-1.3 3-3zM90.6 23.9l-5.2-3c-1.4-.8-3.3-.3-4.1 1.1-.8 1.4-.3 3.3 1.1 4.1l5.2 3c.5.3 1 .4 1.5.4 1 0 2-.5 2.6-1.5.8-1.4.3-3.3-1.1-4.1zm-48-3-5.2 3c-1.4.8-1.9 2.7-1.1 4.1.6 1 1.6 1.5 2.6 1.5.5 0 1-.1 1.5-.4l5.2-3c1.4-.8 1.9-2.7 1.1-4.1-.8-1.4-2.7-1.9-4.1-1.1zM64 26c7.2 0 13-5.8 13-13S71.2 0 64 0 51 5.8 51 13s5.8 13 13 13zm0-20c3.9 0 7 3.1 7 7s-3.1 7-7 7-7-3.1-7-7 3.1-7 7-7zm0 122c7.2 0 13-5.8 13-13s-5.8-13-13-13-13 5.8-13 13 5.8 13 13 13zm0-20c3.9 0 7 3.1 7 7s-3.1 7-7 7-7-3.1-7-7 3.1-7 7-7zm32-18c0 7.2 5.8 13 13 13s13-5.8 13-13-5.8-13-13-13-13 5.8-13 13zm13-7c3.9 0 7 3.1 7 7s-3.1 7-7 7-7-3.1-7-7 3.1-7 7-7zm0-58c-7.2 0-13 5.8-13 13s5.8 13 13 13 13-5.8 13-13-5.8-13-13-13zm0 20c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7zM19 25c-7.2 0-13 5.8-13 13s5.8 13 13 13 13-5.8 13-13-5.8-13-13-13zm0 20c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7zM6 90c0 7.2 5.8 13 13 13s13-5.8 13-13-5.8-13-13-13S6 82.8 6 90zm13-7c3.9 0 7 3.1 7 7s-3.1 7-7 7-7-3.1-7-7 3.1-7 7-7zm48 5c0-1.7-1.3-3-3-3-5.9 0-11.3-2.4-15.3-6.6-4-4.3-6-9.9-5.7-15.7.7-10.5 9.1-19 19.6-19.6 5.9-.4 11.5 1.6 15.7 5.7 4.3 4 6.6 9.4 6.6 15.3v2c0 2.2-1.8 4-4 4s-4-1.8-4-4v-2c0-7.2-5.8-13-13-13s-13 5.8-13 13 5.8 13 13 13c3.8 0 7.2-1.7 9.6-4.3 1.8 2 4.5 3.3 7.4 3.3 5.5 0 10-4.5 10-10v-2c0-7.4-3.1-14.6-8.5-19.7-5.5-5.2-12.7-7.7-20.2-7.3-13.5.8-24.4 11.7-25.2 25.2-.5 7.5 2.1 14.7 7.3 20.2C49.4 87.9 56.6 91 64 91c1.7 0 3-1.3 3-3zm-3-17c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7z" />
      </svg>
      <span class="btm-nav-label">Communities</span>
    </button>
    <button>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -7 80 100" class="stroke-current fill-current w-20 h-20">
        <path
          d="M50 7a10 10 0 0 0 0 20 10 10 0 0 0 0-20zm0 2a8 8 0 1 1 0 16 8 8 0 1 1 0-16zm0 31a10 10 0 0 0 0 20 10 10 0 0 0 0-20zm0 2a8 8 0 1 1 0 16 8 8 0 1 1 0-16zm0 31a10 10 0 0 0 0 20 10 10 0 0 0 0-20zm0 2a8 8 0 1 1 0 16 8 8 0 1 1 0-16z" />
      </svg>
      <span class="btm-nav-label">More</span>
    </button>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import CommentSortSelector from './CommentSortSelector.vue'
import { useOverlayStore } from '@/stores/overlay'
import { useSiteStore } from '@/stores/site'

const overlay = useOverlayStore()
const site = useSiteStore()

let showSortSelector = ref(false)

function toggleSortSelector() {
  if (showSortSelector.value) {
    showSortSelector.value = false
    overlay.visible = false
  } else {
    showSortSelector.value = true
    overlay.visible = true
  }
}

function sortUpdated() {
  overlay.visible = false
  showSortSelector.value = false
}

overlay.$subscribe(() => {
  if (overlay.hideNav) {
    showSortSelector.value = false
  }

  if (overlay.clickActive && (showSortSelector.value)) {
    if (showSortSelector.value) toggleSortSelector()
    overlay.clickActive = false
  }
})

</script>