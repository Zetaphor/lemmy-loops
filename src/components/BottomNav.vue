<template>
  <ViewSelector v-if="showViewSelector" ref="viewSelectorEl" @setView="viewUpdated" />
  <SortSelector v-if="showSortSelector" ref="sortSelectorEl" @setSort="sortUpdated" />

  <div class="btm-nav">
    <button v-if="site.postView == 'All'" @click="toggleViewSelector">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-20 h-full stroke-current fill-current" viewBox="-5 -20 74 90">
        <path
          d="M64 24.14a6.12 6.12 0 0 0-6.113-6.115c-.243 0-.481.018-.717.046l-6.185-7.727a6.403 6.403 0 0 0 .976-3.394A6.457 6.457 0 0 0 45.512.501c-3.048 0-5.603 2.127-6.272 4.974l-15.09.286c-.655-2.109-2.602-3.654-4.924-3.654a5.184 5.184 0 0 0-5.178 5.178c0 .931.267 1.793.698 2.549L4.306 26.005C1.866 26.424 0 28.54 0 31.097c0 2.56 1.87 4.677 4.313 5.092l6.816 10.377a6.743 6.743 0 0 0-1.363 4.063c0 3.739 3.043 6.781 6.783 6.781a6.772 6.772 0 0 0 5.482-2.802l10.304 3.73c.517 2.928 3.074 5.161 6.148 5.161a6.257 6.257 0 0 0 6.216-6.898l4.666-3.129a5.736 5.736 0 0 0 2.925.803 5.786 5.786 0 0 0 5.777-5.781 5.784 5.784 0 0 0-2.971-5.049l3.943-13.302C61.861 29.601 64 27.117 64 24.14zM49.703 43.33 39.246 30.318a6.209 6.209 0 0 0 1.271-2.635l11.503-1.826a6.135 6.135 0 0 0 3.95 4.086l-3.787 12.775a5.727 5.727 0 0 0-2.48.612zm-29.925 1.332a6.782 6.782 0 0 0-1.624-.619l1.068-13.719 9.621-1.263c.375.78.905 1.471 1.554 2.029L19.778 44.662zm-6.346-.054L7.56 35.669a5.155 5.155 0 0 0 2.757-4.176l5.865-.77-1.033 13.266a6.729 6.729 0 0 0-1.717.619zm27.762-32.881-5.552 8.557a6.255 6.255 0 0 0-1.201-.119c-.468 0-.923.057-1.361.155L23.787 9.684c.155-.293.28-.601.377-.924l15.088-.285a6.443 6.443 0 0 0 1.942 3.252zm-6.753 17.87a3.22 3.22 0 0 1-3.215-3.217c0-1.772 1.442-3.215 3.215-3.215s3.215 1.442 3.215 3.215a3.22 3.22 0 0 1-3.215 3.217zm-14.981-2.33 1.169-15.021a5.13 5.13 0 0 0 1.042-.424l8.659 9.911a6.191 6.191 0 0 0-2.09 4.383l-8.78 1.151zm-1.835-15.082L16.42 27.667l-6.757.887a5.189 5.189 0 0 0-2.116-2.037l9.42-14.593c.211.103.431.186.658.261zM61 24.14a3.117 3.117 0 0 1-3.113 3.115c-1.719 0-3.117-1.397-3.117-3.115s1.398-3.115 3.117-3.115A3.116 3.116 0 0 1 61 24.14zm-9.087-1.304-11.504 1.826a6.224 6.224 0 0 0-2.028-3.085l5.454-8.407a6.398 6.398 0 0 0 1.677.229 6.398 6.398 0 0 0 3.328-.936l5.415 6.766a6.126 6.126 0 0 0-2.342 3.607zM45.512 3.501c1.902 0 3.449 1.547 3.449 3.449s-1.547 3.449-3.449 3.449-3.449-1.547-3.449-3.449 1.546-3.449 3.449-3.449zM19.225 5.106c1.202 0 2.18.977 2.18 2.178 0 1.202-.978 2.18-2.18 2.18a2.181 2.181 0 0 1-2.178-2.18 2.18 2.18 0 0 1 2.178-2.178zM3 31.097c0-1.202.978-2.18 2.18-2.18 1.201 0 2.178.978 2.178 2.18s-.977 2.18-2.178 2.18A2.184 2.184 0 0 1 3 31.097zm13.549 23.312a3.786 3.786 0 0 1-3.783-3.781 3.788 3.788 0 0 1 3.783-3.785 3.79 3.79 0 0 1 3.785 3.785 3.787 3.787 0 0 1-3.785 3.781zm5.484-7.76 11.105-14.193c.012.002.022.007.034.009l3.55 18.79a6.268 6.268 0 0 0-4.149 3.978l-9.355-3.387c.072-.396.116-.802.116-1.219a6.737 6.737 0 0 0-1.301-3.978zm16.45 13.85c-1.792 0-3.25-1.458-3.25-3.25s1.458-3.25 3.25-3.25 3.25 1.458 3.25 3.25-1.458 3.25-3.25 3.25zm1.268-9.37-3.549-18.79a6.04 6.04 0 0 0 .639-.225l10.618 13.212a5.745 5.745 0 0 0-.95 3.167c0 1.014.264 1.966.724 2.795l-3.605 2.418a6.269 6.269 0 0 0-3.877-2.577zm12.539.145c-1.533 0-2.781-1.248-2.781-2.781s1.248-2.781 2.781-2.781c1.531 0 2.777 1.248 2.777 2.781s-1.246 2.781-2.777 2.781z" />
      </svg>
      <span class="btm-nav-label">All</span>
    </button>
    <button v-else-if="site.postView == 'Local'" @click="toggleViewSelector">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-20 h-full stroke-current fill-current" viewBox="0 -25 100 125">
        <path
          d="M87 95H61c-2.2 0-4-1.8-4-4V73c0-3.9-3.1-7-7-7s-7 3.1-7 7v18c0 2.2-1.8 4-4 4H13c-2.2 0-4-1.8-4-4V53.1c0-3 1.1-5.8 3.1-8L47 6.3c.8-.8 1.9-1.3 3-1.3s2.2.5 3 1.3L87.9 45c2 2.2 3.1 5.1 3.1 8v38c0 2.2-1.8 4-4 4zm-22-8h18V53.1c0-1-.4-1.9-1-2.7L50 15 18 50.4c-.7.7-1 1.7-1 2.7V87h18V73c0-8.3 6.7-15 15-15s15 6.7 15 15v14z" />
      </svg>
      <span class="btm-nav-label">Local</span>
    </button>
    <button v-else-if="site.postView == 'Subscribed'" @click="toggleViewSelector">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-20 h-full stroke-current fill-current" viewBox="0 -20 90 115">
        <path
          d="M94.26 50a6.545 6.545 0 0 0-6.543-6.544 6.54 6.54 0 0 0-6.205 4.477H68.415a18.447 18.447 0 0 0-3.938-9.486l9.266-9.266a6.542 6.542 0 0 0 7.554-10.477 6.54 6.54 0 0 0-9.253-.001 6.541 6.541 0 0 0-1.223 7.556l-9.265 9.265a18.438 18.438 0 0 0-9.489-3.939V18.491A6.543 6.543 0 0 0 50.003 5.74a6.543 6.543 0 0 0-2.068 12.751v13.093a18.437 18.437 0 0 0-9.486 3.939l-9.266-9.265a6.543 6.543 0 0 0-10.479-7.555 6.544 6.544 0 0 0 0 9.255 6.547 6.547 0 0 0 7.554 1.223l9.266 9.265a18.44 18.44 0 0 0-3.938 9.486H18.492A6.542 6.542 0 0 0 5.74 49.999a6.544 6.544 0 0 0 12.752 2.066h13.093a18.444 18.444 0 0 0 3.938 9.486l-9.266 9.266a6.538 6.538 0 0 0-7.554 1.223 6.545 6.545 0 1 0 9.256 9.256 6.553 6.553 0 0 0 1.223-7.557l9.266-9.266a18.406 18.406 0 0 0 9.486 3.941v13.092a6.544 6.544 0 0 0 2.068 12.752 6.545 6.545 0 0 0 6.543-6.545 6.545 6.545 0 0 0-4.479-6.207v-13.09a18.424 18.424 0 0 0 9.489-3.941l9.265 9.266a6.542 6.542 0 0 0 1.223 7.557 6.54 6.54 0 0 0 9.253 0 6.543 6.543 0 0 0 0-9.256c-2.043-2.047-5.103-2.449-7.554-1.223l-9.266-9.266a18.427 18.427 0 0 0 3.938-9.486h13.097a6.54 6.54 0 0 0 6.205 4.477A6.545 6.545 0 0 0 94.26 50zM64.4 50c0 7.939-6.457 14.4-14.398 14.4S35.6 57.939 35.6 50c0-7.94 6.46-14.401 14.401-14.401S64.4 42.06 64.4 50z" />
      </svg>
      <span class="btm-nav-label">Subscribed</span>
    </button>

    <button v-if="site.postSort == 'New'" @click="toggleSortSelector">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-20 h-full stroke-current fill-current" viewBox="550 200 800 1300">
        <path
          d="M733.652 1243.706a20 20 0 0 1-18.712-12.939c-34.836-92.316-99.33-161.958-147.299-204.124-52.132-45.825-95.956-69.628-96.392-69.863a20 20 0 0 1 0-35.218c.43-.232 44.984-24.522 97.202-70.577 47.678-42.051 111.796-111.475 146.489-203.411a20 20 0 0 1 37.424 0c34.836 92.316 99.33 161.958 147.299 204.125 52.132 45.825 95.956 69.628 96.392 69.863a20 20 0 0 1 0 35.218c-.43.232-44.984 24.522-97.202 70.577-47.678 42.05-111.796 111.475-146.489 203.411a20 20 0 0 1-18.712 12.938zM519.022 939.17c19.016 12.524 45.748 31.692 75.028 57.43 32.603 28.659 61.654 59.604 86.346 91.974 20.924 27.431 38.744 55.946 53.256 85.184 14.512-29.237 32.333-57.753 53.256-85.184 24.691-32.37 53.742-63.314 86.346-91.974 29.28-25.738 56.012-44.906 75.028-57.43-19.016-12.524-45.748-31.692-75.028-57.43-32.603-28.66-61.654-59.604-86.346-91.974-20.924-27.431-38.744-55.946-53.256-85.184-14.512 29.237-32.332 57.753-53.256 85.184-24.691 32.37-53.742 63.314-86.346 91.974-29.28 25.739-56.012 44.906-75.028 57.43zm581.994 516.997a20 20 0 0 1-18.712-12.939c-28.647-75.916-104.481-117.802-105.244-118.217a20.026 20.026 0 0 1-10.47-17.62c.013-7.345 4.035-14.1 10.502-17.582.731-.397 76.565-42.284 105.213-118.2a20 20 0 0 1 37.424 0c28.815 76.359 104.452 117.791 105.213 118.2a20 20 0 0 1 0 35.218c-.731.397-76.565 42.284-105.213 118.2a20.002 20.002 0 0 1-18.713 12.94zm-77.929-148.749c22.39 16.466 54.209 44.368 77.929 83.446 23.72-39.078 55.539-66.979 77.929-83.446-22.39-16.467-54.209-44.369-77.929-83.446-23.72 39.078-55.539 66.98-77.929 83.446zm306.3-296.328a20 20 0 0 1-18.712-12.939c-49.533-131.262-179.356-202.377-180.662-203.08a20 20 0 0 1 0-35.218c.311-.168 33.443-18.254 72.248-52.517 35.3-31.168 82.764-82.59 108.414-150.563a20 20 0 0 1 37.424 0c25.65 67.973 73.114 119.395 108.414 150.563 38.805 34.263 71.937 52.349 72.267 52.527a20.015 20.015 0 0 1 10.489 17.616 20 20 0 0 1-10.508 17.593c-.311.168-33.443 18.254-72.248 52.518-35.3 31.168-82.764 82.59-108.414 150.563a20 20 0 0 1-18.712 12.937zm-152.199-233.628c13.792 9.402 31.53 22.543 50.677 39.375 31.586 27.765 72.035 70.316 101.522 125.889 29.488-55.572 69.936-98.124 101.522-125.889 19.147-16.832 36.885-29.972 50.677-39.375-13.792-9.402-31.529-22.543-50.677-39.375-31.586-27.765-72.034-70.316-101.522-125.889-29.487 55.573-69.936 98.124-101.522 125.889-19.147 16.832-36.885 29.973-50.677 39.375z" />
      </svg>
      <span class="btm-nav-label">New</span>
    </button>
    <button v-else-if="site.postSort == 'Hot'" @click="toggleSortSelector">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-20 h-full stroke-current fill-current" viewBox="-10 935 110 115">
        <path
          d="M55.844 957.354c-6.228 2.791-11.51 12.895-12.782 18.658-.517 2.51-.587 4.975-.437 7.438-.83-1.72-1.448-3.695-1.625-6.313a3.068 3.068 0 0 0-1.844-2.575 3.068 3.068 0 0 0-3.125.512C24.861 984.814 18 999.472 18 1013.765c0 15.758 9.07 26.177 21.969 33.222 1.096.612 2.578.435 3.5-.418.922-.853 1.213-2.316.687-3.457-.662-1.453-1.156-2.84-1.156-4.344 0-4.968 3.123-10.234 7-12.814 3.879 2.578 7 7.841 7 12.814 0 1.49-.497 2.89-1.156 4.344-.526 1.14-.235 2.604.687 3.457.922.854 2.404 1.03 3.5.418C72.943 1039.945 82 1029.534 82 1013.765c0-13.65-6.752-22.669-12.719-30.315-5.967-7.646-10.95-13.772-10.281-22.877.126-1.695-1.459-3.312-3.156-3.219zm-2.282 10.407c1.674 7.613 6.494 13.603 11 19.377C70.475 994.714 76 1002.049 76 1013.765c0 11.133-4.895 18.352-13.125 24.19-.31-7.74-4.834-15.113-11.594-18.314a3.045 3.045 0 0 0-2.562 0c-6.754 3.203-11.283 10.575-11.594 18.314-8.226-5.842-13.125-13.07-13.125-24.19 0-10.63 4.583-21.94 12.125-30.346 1.762 5.277 5.302 8.96 9.281 11.47.99.621 2.35.588 3.31-.08.959-.668 1.461-1.933 1.221-3.077-1.213-5.75-1.889-10.188-1-14.501.603-2.922 2.014-5.978 4.626-9.47z" />
      </svg>
      <span class="btm-nav-label">Hot</span>
    </button>
    <button v-else-if="site.postSort == 'Active'" @click="toggleSortSelector">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-20 h-full stroke-current fill-current" viewBox="10 955 75 80">
        <path
          d="M44.813 974.385a2 2 0 0 0-1.75 1.531l-7.938 33.532-5.469-8.188a2 2 0 0 0-1.656-.906H8a2 2 0 1 0 0 4h18.938l7.406 11.125a2 2 0 0 0 3.593-.656l6.75-28.5 7.344 42.406a2 2 0 0 0 3.907.094l7.937-33.531 5.469 8.187a2 2 0 0 0 1.656.906l21-.03a2 2 0 1 0 0-4l-19.938.03-7.406-11.124a2 2 0 0 0-3.594.656l-6.75 28.531-7.343-42.406a2 2 0 0 0-2.157-1.656z" />
      </svg>
      <span class="btm-nav-label">Active</span>
    </button>

    <!-- <button>
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 -15 52.6699 74.729" class="stroke-current fill-current w-20 h-full">
        <path
          d="M29.2295,7.2754V0L12.0957,9.8936l17.1338,9.8926v-6.7764C39.2549,14.4258,47,23.0381,47,33.4482  c0,11.3945-9.2705,20.665-20.665,20.665s-20.665-9.2705-20.665-20.665c0-3.0195,0.6338-5.9277,1.8857-8.6406  c0.6553-1.4219,0.0342-3.1064-1.3867-3.7617c-1.4219-0.6523-3.1055-0.0342-3.7617,1.3867C0.8105,25.8965,0,29.6025,0,33.4482  c0,14.5205,11.8145,26.335,26.335,26.335s26.335-11.8145,26.335-26.335C52.6699,19.9062,42.3926,8.7217,29.2295,7.2754z" />
      </svg>
      <span class="btm-nav-label">Refresh</span>
    </button> -->

    <button>
      <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current fill-current w-20 h-full" viewBox="0 -30 128 160">
        <path
          d="M22 67v-6c0-1.7-1.3-3-3-3s-3 1.3-3 3v6c0 1.7 1.3 3 3 3s3-1.3 3-3zm15.4 37.1 5.2 3c.5.3 1 .4 1.5.4 1 0 2-.5 2.6-1.5.8-1.4.3-3.3-1.1-4.1l-5.2-3c-1.4-.8-3.3-.3-4.1 1.1-.8 1.4-.3 3.3 1.1 4.1zm54.3-4.1c-.8-1.4-2.7-1.9-4.1-1.1l-5.2 3c-1.4.8-1.9 2.7-1.1 4.1.6 1 1.6 1.5 2.6 1.5.5 0 1-.1 1.5-.4l5.2-3c1.4-.8 1.9-2.7 1.1-4.1zM112 67v-6c0-1.7-1.3-3-3-3s-3 1.3-3 3v6c0 1.7 1.3 3 3 3s3-1.3 3-3zM90.6 23.9l-5.2-3c-1.4-.8-3.3-.3-4.1 1.1-.8 1.4-.3 3.3 1.1 4.1l5.2 3c.5.3 1 .4 1.5.4 1 0 2-.5 2.6-1.5.8-1.4.3-3.3-1.1-4.1zm-48-3-5.2 3c-1.4.8-1.9 2.7-1.1 4.1.6 1 1.6 1.5 2.6 1.5.5 0 1-.1 1.5-.4l5.2-3c1.4-.8 1.9-2.7 1.1-4.1-.8-1.4-2.7-1.9-4.1-1.1zM64 26c7.2 0 13-5.8 13-13S71.2 0 64 0 51 5.8 51 13s5.8 13 13 13zm0-20c3.9 0 7 3.1 7 7s-3.1 7-7 7-7-3.1-7-7 3.1-7 7-7zm0 122c7.2 0 13-5.8 13-13s-5.8-13-13-13-13 5.8-13 13 5.8 13 13 13zm0-20c3.9 0 7 3.1 7 7s-3.1 7-7 7-7-3.1-7-7 3.1-7 7-7zm32-18c0 7.2 5.8 13 13 13s13-5.8 13-13-5.8-13-13-13-13 5.8-13 13zm13-7c3.9 0 7 3.1 7 7s-3.1 7-7 7-7-3.1-7-7 3.1-7 7-7zm0-58c-7.2 0-13 5.8-13 13s5.8 13 13 13 13-5.8 13-13-5.8-13-13-13zm0 20c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7zM19 25c-7.2 0-13 5.8-13 13s5.8 13 13 13 13-5.8 13-13-5.8-13-13-13zm0 20c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7zM6 90c0 7.2 5.8 13 13 13s13-5.8 13-13-5.8-13-13-13S6 82.8 6 90zm13-7c3.9 0 7 3.1 7 7s-3.1 7-7 7-7-3.1-7-7 3.1-7 7-7zm48 5c0-1.7-1.3-3-3-3-5.9 0-11.3-2.4-15.3-6.6-4-4.3-6-9.9-5.7-15.7.7-10.5 9.1-19 19.6-19.6 5.9-.4 11.5 1.6 15.7 5.7 4.3 4 6.6 9.4 6.6 15.3v2c0 2.2-1.8 4-4 4s-4-1.8-4-4v-2c0-7.2-5.8-13-13-13s-13 5.8-13 13 5.8 13 13 13c3.8 0 7.2-1.7 9.6-4.3 1.8 2 4.5 3.3 7.4 3.3 5.5 0 10-4.5 10-10v-2c0-7.4-3.1-14.6-8.5-19.7-5.5-5.2-12.7-7.7-20.2-7.3-13.5.8-24.4 11.7-25.2 25.2-.5 7.5 2.1 14.7 7.3 20.2C49.4 87.9 56.6 91 64 91c1.7 0 3-1.3 3-3zm-3-17c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7z" />
      </svg>
      <span class="btm-nav-label">Communities</span>
    </button>
    <button>
      <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current fill-current w-20 h-20" viewBox="0 -10 30 40">
        <path
          d="M16 22c-2.208 0-4 1.792-4 4s1.792 4 4 4 4-1.792 4-4-1.792-4-4-4Zm0 2a2 2 0 1 1-.001 4.001A2 2 0 0 1 16 24Zm0-12c-2.208 0-4 1.792-4 4s1.792 4 4 4 4-1.792 4-4-1.792-4-4-4Zm0 2a2 2 0 1 1-.001 4.001A2 2 0 0 1 16 14Zm0-12c-2.208 0-4 1.792-4 4s1.792 4 4 4 4-1.792 4-4-1.792-4-4-4Zm0 2a2 2 0 1 1-.001 4.001A2 2 0 0 1 16 4Z" />
      </svg>
      <span class="btm-nav-label">More</span>
    </button>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import ViewSelector from './ViewSelector.vue'
import SortSelector from './SortSelector.vue'
import { useSiteStore } from '@/stores/site'
import { useOverlayStore } from '@/stores/overlay'
import { onClickOutside } from '@vueuse/core'

const site = useSiteStore()
const overlay = useOverlayStore()
const viewSelectorEl = ref(null)
const sortSelectorEl = ref(null)

let showViewSelector = ref(false)
let showSortSelector = ref(false)

function toggleViewSelector() {
  showSortSelector.value = false
  if (showViewSelector.value) {
    showViewSelector.value = false
    overlay.visible = false
  } else {
    showViewSelector.value = true
    overlay.visible = true
  }
}

function toggleSortSelector() {
  showViewSelector.value = false
  if (showSortSelector.value) {
    showSortSelector.value = false
    overlay.visible = false
  } else {
    showSortSelector.value = true
    overlay.visible = true
  }
}

function viewUpdated() {
  overlay.visible = false
  showViewSelector.value = false
  site.setPostsStale(true)
}

function sortUpdated() {
  overlay.visible = false
  showSortSelector.value = false
  site.setPostsStale(true)
}

onClickOutside(viewSelectorEl, () => toggleViewSelector())
onClickOutside(sortSelectorEl, () => toggleSortSelector())

</script>